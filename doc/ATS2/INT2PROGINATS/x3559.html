<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>選言的な観</TITLE
><META
CHARSET="UTF-8"><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="ATSプログラミング入門"
HREF="book1.html"><LINK
REL="UP"
TITLE="線形なデータ命題としてのデータ観 (dataview)"
HREF="c3536.html"><LINK
REL="PREVIOUS"
TITLE="線形なデータ命題としてのデータ観 (dataview)"
HREF="c3536.html"><LINK
REL="NEXT"
TITLE="線形配列のデータ観"
HREF="x3600.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="./assets/INT2PROGINATS-BOOK.css"></HEAD
><BODY
CLASS="sect1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>ATSプログラミング入門: </TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="c3536.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Chapter 14. 線形なデータ命題としてのデータ観 (dataview)</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="x3600.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="disjunctive_views"
>選言的な観</A
></H1
><P
>&#13;データ観 <FONT
COLOR="RED"
>VOR</FONT
> は次のように宣言されています:

<DIV
CLASS="informalexample"
><P
></P
><A
NAME="AEN3563"
></A
><PRE
CLASS="programlisting"
><p class="patsyntax"><span class="keyword">dataview</span> <span class="staexp">VOR <span class="keyword">(</span>v0<span class="keyword">:</span><span class="keyword">view+</span><span class="keyword">,</span> v1<span class="keyword">:</span><span class="keyword">view+</span><span class="keyword">,</span> int<span class="keyword">)</span> <span class="keyword">=</span>
  <span class="keyword">|</span> <span class="prfexp">VORleft <span class="keyword">(</span><span class="staexp">v0</span><span class="keyword">,</span> <span class="staexp">v1</span><span class="keyword">,</span> <span class="staexp">0</span><span class="keyword">)</span> <span class="keyword">of</span> <span class="keyword">(</span><span class="staexp">v0</span><span class="keyword">)</span></span> <span class="keyword">|</span> <span class="prfexp">VORright <span class="keyword">(</span><span class="staexp">v0</span><span class="keyword">,</span> <span class="staexp">v1</span><span class="keyword">,</span> <span class="staexp">1</span><span class="keyword">)</span> <span class="keyword">of</span> <span class="keyword">(</span><span class="staexp">v1</span><span class="keyword">)</span></span></span>
</p></PRE
><P
></P
></DIV
>


この宣言はデータ観 <FONT
COLOR="RED"
>VOR</FONT
> が1番目と2番目の引数について共変であることを示しています。
そして関連する2つの証明コンストラクタ <FONT
COLOR="RED"
>VORleft</FONT
> と <FONT
COLOR="RED"
>VORright</FONT
> があります。
観 V<SUB
>0</SUB
> と V<SUB
>1</SUB
> が与えられた時、
<FONT
COLOR="RED"
>VOR(V<SUB
>0</SUB
>, V<SUB
>1</SUB
>, 0)</FONT
> の証明は V<SUB
>0</SUB
> の証明になります。
また <FONT
COLOR="RED"
>VOR(V<SUB
>0</SUB
>, V<SUB
>1</SUB
>, 1)</FONT
> の証明は V<SUB
>1</SUB
> の証明になります。

</P
><P
>&#13;なんらかの型 T を考えます。次の関数インターフェイスは <FONT
COLOR="RED"
>getopt</FONT
>
が未初期化のポインタを取り、ポインタが初期化されたかどうかを示す整数を返すことを表わしています:

<DIV
CLASS="informalexample"
><P
></P
><A
NAME="AEN3580"
></A
><PRE
CLASS="programlisting"
><p class="patsyntax"><span class="dynexp"><span class="keyword">fun</span> getopt<span class="staexp"><span class="keyword">{</span>l<span class="keyword">:</span>addr<span class="keyword">}</span></span>
  <span class="keyword">(</span><span class="prfexp">pf<span class="keyword">:</span> <span class="staexp">T</span><span class="staexp">?</span> <span class="staexp"><span class="keyword">@</span></span> <span class="staexp">l</span></span> <span class="keyword">|</span> <span class="staexp">ptr</span> <span class="keyword">(</span><span class="staexp">l</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><span class="keyword">[</span>i<span class="keyword">:</span>int<span class="keyword">]</span></span> <span class="keyword">(</span><span class="staexp">VOR</span> <span class="keyword">(</span><span class="staexp">T</span><span class="staexp">?</span> <span class="staexp"><span class="keyword">@</span></span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">T</span> <span class="staexp"><span class="keyword">@</span></span> <span class="staexp">l</span><span class="keyword">,</span> <span class="staexp">i</span><span class="keyword">)</span> <span class="keyword">|</span> <span class="staexp">int</span> <span class="keyword">(</span><span class="staexp">i</span><span class="keyword">)</span><span class="keyword">)</span></span>
</p></PRE
><P
></P
></DIV
>


次のコードは <FONT
COLOR="RED"
>getopt</FONT
> の典型的な使用例を示しています:

<DIV
CLASS="informalexample"
><P
></P
><A
NAME="AEN3583"
></A
><PRE
CLASS="programlisting"
><p class="patsyntax"><span class="dynexp"><span class="keyword">fun</span> foo <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">var</span> x<span class="keyword">:</span> <span class="staexp">T</span><span class="staexp">?</span>
  <span class="dynexp"><span class="keyword">val</span> <span class="keyword">(</span><span class="prfexp">pfor</span> <span class="keyword">|</span> i<span class="keyword">)</span> <span class="keyword">=</span> getopt <span class="keyword">(</span><span class="prfexp"><span class="dynexp"><span class="keyword">view@</span></span><span class="keyword">(</span>x<span class="keyword">)</span></span> <span class="keyword">|</span> <span class="dynexp"><span class="keyword">addr@</span></span><span class="keyword">(</span>x<span class="keyword">)</span><span class="keyword">)</span></span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> i <span class="keyword">=</span> <span class="dynexp">0</span>
  <span class="keyword">then</span> <span class="keyword">let</span>
    <span class="prfexp"><span class="keyword">prval</span> VORleft <span class="keyword">(</span>pf0<span class="keyword">)</span> <span class="keyword">=</span> pfor</span> <span class="keyword">in</span> <span class="dynexp"><span class="keyword">view@</span></span><span class="keyword">(</span>x<span class="keyword">)</span> := pf0 <span class="comment">// uninitialized</span>
  <span class="keyword">end</span> <span class="comment">// end of [then]</span>
  <span class="keyword">else</span> <span class="keyword">let</span>
    <span class="prfexp"><span class="keyword">prval</span> VORright <span class="keyword">(</span>pf1<span class="keyword">)</span> <span class="keyword">=</span> pfor</span> <span class="keyword">in</span> <span class="dynexp"><span class="keyword">view@</span></span><span class="keyword">(</span>x<span class="keyword">)</span> := pf1 <span class="comment">// initialized</span>
  <span class="keyword">end</span> <span class="comment">// end of [else]</span>
<span class="comment">// end of [if]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [foo]</span>
</p></PRE
><P
></P
></DIV
>


</P
><P
>&#13;ATS には、型 T とブール B を取り、opt 型 <FONT
COLOR="RED"
>opt(T, B)</FONT
> を作るような型コンストラクタ <FONT
COLOR="RED"
>opt</FONT
>
があります。
このとき B が true ならば <FONT
COLOR="RED"
>opt(T, B)</FONT
> は T に等しく、B が false ならそれは T? に等しくなります。
関数 <FONT
COLOR="RED"
>getopt</FONT
> には次のような opt 型を使ったインターフェイスを与えることができます:

<DIV
CLASS="informalexample"
><P
></P
><A
NAME="AEN3590"
></A
><PRE
CLASS="programlisting"
><p class="patsyntax"><span class="dynexp"><span class="keyword">fun</span> getopt <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp">&amp;</span><span class="staexp">T</span><span class="staexp">?</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">opt</span> <span class="keyword">(</span><span class="staexp">T</span><span class="keyword">,</span> <span class="staexp">b</span><span class="keyword">)</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp"><span class="keyword">#[</span>b<span class="keyword">:</span>bool<span class="keyword">]</span></span> <span class="staexp">bool</span><span class="keyword">(</span><span class="staexp">b</span><span class="keyword">)</span></span>
</p></PRE
><P
></P
></DIV
>


これで <FONT
COLOR="RED"
>getopt</FONT
> 呼び出しコードは次のように実装できます:

<DIV
CLASS="informalexample"
><P
></P
><A
NAME="AEN3593"
></A
><PRE
CLASS="programlisting"
><p class="patsyntax"><span class="dynexp"><span class="keyword">fun</span> foo <span class="keyword">(</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span> <span class="keyword">=</span> <span class="keyword">let</span>
  <span class="keyword">var</span> x<span class="keyword">:</span> <span class="staexp">T</span><span class="staexp">?</span>
  <span class="dynexp"><span class="keyword">val</span> ans <span class="keyword">=</span> getopt <span class="keyword">(</span>x<span class="keyword">)</span></span>
<span class="keyword">in</span>
<span class="comment">//</span>
<span class="keyword">if</span> <span class="keyword">(</span>ans<span class="keyword">)</span>
  <span class="keyword">then</span> <span class="keyword">let</span>
    <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> opt_unsome<span class="keyword">(</span>x<span class="keyword">)</span></span> <span class="dynexp"><span class="keyword">in</span> <span class="comment">(*initialized*)</span>
  <span class="keyword">end</span></span> <span class="comment">// end of [then]</span>
  <span class="keyword">else</span> <span class="keyword">let</span>
    <span class="prfexp"><span class="keyword">prval</span> <span class="keyword">(</span><span class="keyword">)</span> <span class="keyword">=</span> opt_unnone<span class="keyword">(</span>x<span class="keyword">)</span></span> <span class="dynexp"><span class="keyword">in</span> <span class="comment">(*uninitialized*)</span>
  <span class="keyword">end</span></span> <span class="comment">// end of [else]</span>
<span class="comment">// end of [if]</span>
<span class="comment">//</span>
<span class="keyword">end</span></span> <span class="comment">// end of [foo]</span>
</p></PRE
><P
></P
></DIV
>


このとき、証明関数 <FONT
COLOR="RED"
>opt_unsome</FONT
> と <FONT
COLOR="RED"
>opt_unnone</FONT
> には次の型が割り当てられています:

<DIV
CLASS="informalexample"
><P
></P
><A
NAME="AEN3597"
></A
><PRE
CLASS="programlisting"
><p class="patsyntax"><span class="prfexp"><span class="keyword">prfun</span> opt_unsome<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span><span class="keyword">t@ype</span><span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">opt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">true</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">a</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
<span class="prfexp"><span class="keyword">prfun</span> opt_unnone<span class="staexp"><span class="keyword">{</span>a<span class="keyword">:</span><span class="keyword">t@ype</span><span class="keyword">}</span></span> <span class="keyword">(</span>x<span class="keyword">:</span> <span class="staexp"><span class="keyword">!</span></span><span class="staexp">opt</span> <span class="keyword">(</span><span class="staexp">a</span><span class="keyword">,</span> <span class="staexp">false</span><span class="keyword">)</span> <span class="staexp">&gt;&gt;</span> <span class="staexp">a</span><span class="staexp">?</span><span class="keyword">)</span><span class="keyword">:</span> <span class="staexp">void</span></span>
</p></PRE
><P
></P
></DIV
>


<FONT
COLOR="RED"
>VOR</FONT
> を使うバージョンと比較して、
opt 型を用いたこのバージョンはかなりすっきりしています。

</P
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="c3536.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="book1.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="x3600.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>線形なデータ命題としてのデータ観 (dataview)</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="c3536.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>線形配列のデータ観</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>